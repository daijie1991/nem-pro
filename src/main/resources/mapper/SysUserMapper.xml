<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.nem.pro.modules.sys.mapper.SysUserMapper">
    <!-- 结果集 -->
    <resultMap id="SysUserMap" type="com.nem.pro.modules.sys.domain.SysUser">
        <id property="id" column="id"></id>
        <result property="username" column="username"></result>
        <result property="password" column="password"></result>
        <result property="enable" column="enable"></result>
        <result property="nickname" column="nickname"></result>
        <result property="avatar" column="avatar"></result>
        <result property="gender" column="gender"></result>
        <result property="email" column="email"></result>
        <result property="phone" column="phone"></result>
        <result property="createBy" column="create_by"></result>
        <result property="createTime" column="create_time"></result>
        <result property="updateBy" column="update_by"></result>
        <result property="updateTime" column="update_time"></result>
        <result property="locked" column="locked"></result>
        <result property="remark" column="remark"></result>
        <result property="tenantId" column="tenant_id"></result>
        <result property="projectId" column="project_id"></result>
        <result property="deptId" column="dept_id"></result>
        <result property="postId" column="post_id"></result>
    </resultMap>

    <!--根据 Username 加载 SysUser -->
    <select id="selectByUsername" parameterType="string" resultMap="SysUserMap">
        select * from sys_user where username = #{username}
    </select>

    <!-- 根据 SysUser 条件查询用户列表 -->
    <select id="selectList" resultMap="SysUserMap">
        select * from sys_user
        <where>
            <if test="username!=null and username!=''">
                and username like "%"#{username}"%"
            </if>
            <if test="nickname!=null and nickname!=''">
                and nickname like "%"#{nickname}"%"
            </if>
            <if test="deptId!=null and deptId!=''">
                <choose>
                    <when  test="deptId=='-1'">
                        and dept_id is null
                    </when>
                    <otherwise>
                        and dept_id = #{deptId}
                    </otherwise>
                </choose>
            </if>
        </where>
    </select>

    <!-- 根据参数查询-->
    <select id="selectUser" parameterType="com.nem.pro.modules.sys.param.SysUserRequest" resultType="com.nem.pro.modules.sys.domain.SysUser">
        select * ,
        sp.name as postName,
        sd.name as deptName
        from sys_user su
        left join sys_post sp on sp.id = su.post_id
        left join sys_dept sd on sd.id = su.dept_id
        <where>
            <if test="request.username!=null and request.username!=''">
                and su.username like concat('%', #{request.username}, '%')
            </if>
            <if test="request.nickname!=null and request.nickname!=''">
                and su.nickname like concat('%', #{request.nickname}, '%')
            </if>
        </where>
    </select>

    <!-- 根据 Id 查询用户-->
    <select id="selectById" parameterType="string" resultMap="SysUserMap">
        select * from sys_user where id = #{id}
    </select>

    <!-- 新增 SysUser 数据 -->
    <insert id="insert" parameterType="com.nem.pro.modules.sys.domain.SysUser">
        insert into sys_user
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="userId!=null">
                id,
            </if>
            <if test="username!=null">
                username,
            </if>
            <if test="password!=null">
                password,
            </if>
            <if test="enable">
                enable,
            </if>
            <if test="nickname!=null">
                nickname,
            </if>
            <if test="avatar!=null">
                avatar,
            </if>
            <if test="gender!=null">
                gender,
            </if>
            <if test="email!=null">
                email,
            </if>
            <if test="phone!=null">
                phone,
            </if>
            <if test="deleted!=null">
                deleted,
            </if>
            <if test="createBy!=null">
                create_by,
            </if>
            <if test="createTime!=null">
                create_time,
            </if>
            <if test="updateBy!=null">
                update_by,
            </if>
            <if test="updateTime!=null">
                update_time,
            </if>
            <if test="locked">
                locked,
            </if>
            <if test="remark!=null and remark!=''">
                remark,
            </if>
            <if test="tenantId!=null and tenantId!=''">
                tenant_id,
            </if>
            <if test="projectId!=null and projectId!=''">
                project_id,
            </if>
            <if test="deptId!=null and deptId!=''">
                dept_id,
            </if>
            <if test="postId!=null and postId!=''">
                post_id,
            </if>
        </trim>
        <trim prefix="values(" suffix=")" suffixOverrides=",">
            <if test="id!=null">
                #{id},
            </if>
            <if test="username!=null">
                #{username},
            </if>
            <if test="password!=null">
                #{password},
            </if>
            <if test="enable!=null and enable!=''">
                #{enable},
            </if>
            <if test="nickname!=null">
                #{nickname},
            </if>
            <if test="avatar!=null">
                #{avatar},
            </if>
            <if test="gender!=null">
                #{gender},
            </if>
            <if test="email!=null">
                #{email},
            </if>
            <if test="phone!=null">
                #{phone},
            </if>
            <if test="deleted!=null and deleted!=''">
                #{deleted},
            </if>
            <if test="createBy!=null and createBy!=''">
                #{createBy},
            </if>
            <if test="createTime!=null and createTime!=''">
                #{createTime},
            </if>
            <if test="updateBy!=null and updateBy!=''">
                #{updateBy},
            </if>
            <if test="updateTime!=null and updateTime!=''">
                #{updateTime},
            </if>
            <if test="locked!=null and locked!=''">
                #{locked},
            </if>
            <if test="remark!=null and remark!=''">
                #{remark},
            </if>
            <if test="tenantId!=null and tenantId!=''">
                #{tenantId},
            </if>
            <if test="projectId!=null and projectId!=''">
                #{projectId},
            </if>
            <if test="deptId!=null and deptId!=''">
                #{deptId},
            </if>
            <if test="postId!=null and postId!=''">
                #{postId},
            </if>
        </trim>
    </insert>

    <!-- 根据 Id 修改用户数据 -->
    <update id="updateById" parameterType="com.nem.pro.modules.sys.domain.SysUser">
        update sys_user
        <set>
            <if test="username">
                username = #{username},
            </if>
            <if test="password!=null and password!=''">
                password = #{password},
            </if>
            <if test="enable!=null and enable!=''">
                enable = #{enable},
            </if>
            <if test="nickname">
                nickname = #{nickname},
            </if>
            <if test="avatar!=null">
                avatar = #{avatar},
            </if>
            <if test="gender!=null and gender!=''">
                gender = #{gender},
            </if>
            <if test="email!=null and email!=''">
                email = #{email},
            </if>
            <if test="phone!=null and phone!=''">
                phone = #{phone},
            </if>
            <if test="updateBy!=null">
                update_by = #{updateBy},
            </if>
            <if test="updateTime!=null">
                update_time = #{updateTime},
            </if>
            <if test="remark!=null">
                remark = #{remark},
            </if>
            <if test="tenantId!=null and tenantId!=''">
                tenant_id = #{tenantId},
            </if>
            <if test="projectId!=null and projectId!=''">
                project_id = #{projectId},
            </if>
            <if test="deptId!=null and deptId!=''">
                dept_id = #{deptId},
            </if>
            <if test="postId!=null and postId!=''">
                post_id = #{postId},
            </if>

        </set>
        where id = #{id}
    </update>

    <!-- 根据 Id 删除用户数据 -->
    <delete id="deleteById" parameterType="string">
          delete from sys_user where user_id = #{id}
    </delete>

    <!-- 根据 Id 批量删除用户数据 -->
    <delete id="deleteByIds" parameterType="string">
        delete from sys_user where user_id in
        <foreach item="id" collection="array" open="(" separator="," close=")">
            #{id}
        </foreach>
    </delete>

    <!-- 根据部门字段清空部门字段 -->
    <update id="resetDeptByDeptId" parameterType="string">
        update sys_user
        set dept_id = ""
        where dept_id = #{deptId}
    </update>

    <!-- 根据部门字段清空部门字段 -->
    <update id="resetDeptByDeptIds" parameterType="string">
        update sys_user
        set dept_id = ""
        where dept_id in
        <foreach collection ="deptIds" item="deptId" open="(" separator="," close=")">
            #{deptId}
        </foreach >
    </update>
</mapper>
